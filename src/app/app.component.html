<div class="theme-toggle-container">
  <label class="theme-switch">
    <input type="checkbox" (change)="toggleTheme()" [checked]="isDarkMode">
    <span class="slider"></span>
  </label>
</div>

<div class="container">
  <header>
    <h1>Mood Music ðŸŽµ</h1>
    <p>Get a playlist that matches your vibe. How are you feeling?</p>
  </header>

  <main>
    <div *ngIf="!isLoading && !results" class="input-container">
      <div class="input-card">
        <h3>From a Selfie</h3>
        <p>Let our AI detect your emotion from an image.</p>
        <label for="file-upload" class="upload-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 7.828 3h.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 11.828 5H13a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/><path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/></svg>
          Upload Image
        </label>
        <input id="file-upload" type="file" (change)="onFileSelected($event)" accept="image/*">
      </div>
      <div class="input-card">
        <h3>From Your Words</h3>
        <p>Tell us how you feel in one or two words.</p>
        <div class="text-search-form">
          <input #moodInput type="text" class="mood-input" placeholder="e.g., Happy, Romantic" (keyup.enter)="onTextSearch(moodInput.value)">
          <button (click)="onTextSearch(moodInput.value)" class="search-button">Go</button>
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="state-indicator">
      <div class="spinner"></div>
      <p>Finding your vibe...</p>
    </div>
    
    <div *ngIf="errorMessage" [@fadeInOut] class="state-indicator error-message">
        <h3>Oops! Something went wrong.</h3>
        <p>{{ errorMessage }}</p>
        <button (click)="reset()" class="reset-button">Try Again</button>
    </div>

    <div *ngIf="results && !isLoading && !errorMessage" [@fadeInOut] class="results-section">
      <h2>We sense you're feeling <span class="emotion">{{ results.emotion }}</span></h2>
      <p>Here are some tracks for you:</p>
      
      <div class="track-list">
        <div *ngFor="let track of results.tracks" class="track-card">
          <img [src]="track.album_art_url || 'https://placehold.co/64x64/EFEFEF/333333?text=Art'" alt="Album Art" class="album-art">
          <div class="track-info">
            <strong>{{ track.name }}</strong>
            <p>{{ track.artist }}</p>
            <a *ngIf="track.spotify_url" [href]="track.spotify_url" target="_blank" class="spotify-link">Listen on Spotify</a>
          </div>
          <audio *ngIf="track.has_preview" [src]="track.preview_url" controls class="audio-player"></audio>
          <div *ngIf="!track.has_preview" class="no-preview">No Preview</div>
        </div>
      </div>
      
      <button (click)="reset()" class="reset-button">Search Again</button>
    </div>
  </main>
</div>
