<!-- recommendation-page.component.html -->
<div class="container">
  <!-- Theme Toggle -->
  <div class="theme-toggle-container">
    <app-theme-toggle [isDarkMode]="isDarkMode" (themeChange)="toggleTheme()">
    </app-theme-toggle>
  </div>

  <!-- User Header -->
  <app-user-header
    [user]="currentUser"
    (logout)="logout()"
    (viewHistory)="viewHistory()"
    (openPreferences)="openPreferences()"
  >
  </app-user-header>

  <!-- Main Header -->
  <header>
    <h1>MoodTune</h1>
    <p>
      Discover music that matches your emotions through AI-powered mood
      detection.
    </p>
  </header>

  <!-- Step Section -->
  <div class="step-section" *ngIf="!results && !isLoading">
    <div class="step-header">
      <div class="step-number">1</div>
      <div class="step-content">
        <h2>Choose Your Input Method</h2>
        <p>Select how you'd like to express your current mood</p>
      </div>
    </div>

    <div class="input-container">
      <app-image-upload-card
        [uploadedImageData]="uploadedImageData"
        [detectedMood]="detectedMood"
        [moodConfidence]="moodConfidence"
        (fileSelected)="onFileSelected($event)"
        (clearImage)="clearUploadedImage()"
      >
      </app-image-upload-card>

      <app-text-search-card
        (textSearch)="onTextSearch($event)"
        (suggestionSelected)="onSuggestionSelected($event)"
      >
      </app-text-search-card>
    </div>
  </div>

  <!-- Loading State -->
  <app-loading-state *ngIf="isLoading" [message]="loadingMessage">
  </app-loading-state>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="error-message">
    <div class="error-icon">⚠️</div>
    <h3>Oops! Something went wrong</h3>
    <p>{{ errorMessage }}</p>
    <button class="retry-button">Try Again</button>
  </div>
  <!-- Results Section -->
  <div *ngIf="results && !isLoading" class="results-section">
    <app-playlist-header
      [result]="results"
      (playAll)="playAll()"
      (savePlaylist)="saveAsPlaylist()"
    >
    </app-playlist-header>

    <app-track-list
      [tracks]="results.tracks"
      [expandedTrackId]="expandedTrackId"
      [currentlyPlaying]="currentlyPlaying"
      (toggleExpansion)="toggleTrackExpansion($event)"
      (playPreview)="playPreview($event)"
    >
    </app-track-list>

    <app-action-buttons (refreshTracks)="refreshTracks()" (newSearch)="reset()">
    </app-action-buttons>
  </div>
</div>
