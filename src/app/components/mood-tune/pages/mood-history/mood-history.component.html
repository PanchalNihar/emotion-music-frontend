<div class="mood-history-page">
  <!-- Header Section -->
  <div class="page-header">
    <button class="back-btn" (click)="goBackToRecommendations()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
      </svg>
      Back to Recommendations
    </button>
    
    <div class="header-content">
      <h1>Mood Analytics Dashboard</h1>
      <p>Comprehensive analysis of emotional patterns and music discovery trends</p>
    </div>

    <div class="time-range-selector">
      <label for="timeRange">Analysis Period:</label>
      <select id="timeRange" 
              [(ngModel)]="selectedDays" 
              (change)="onTimeRangeChange()"
              class="time-select">
        <option *ngFor="let option of timeRangeOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <h3>Loading Analytics Data</h3>
    <p>Processing emotional insights and trends</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M21,9V7L15,1H5C3.89,1 3,1.89 3,3V21A2,2 0 0,0 5,23H19A2,2 0 0,0 21,21V9M19,9H14V4H5V19H19V9Z" />
      </svg>
    </div>
    <h3>Data Loading Error</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadMoodHistory()">Retry Analysis</button>
  </div>

  <!-- Content -->
  <div *ngIf="moodHistory && !isLoading" class="content-grid">
    <!-- Overview Stats -->
    <div class="stats-overview">
      <div class="stat-card total-entries">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z" />
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ moodHistory.total_entries }}</h3>
          <p>Total Data Points</p>
        </div>
      </div>
      
      <div class="stat-card date-range">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,3H18V1H16V3H8V1H6V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z" />
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ selectedDays }}</h3>
          <p>Days Analyzed</p>
        </div>
      </div>
      
      <div class="stat-card most-common" *ngIf="getMostCommonMood()">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z" />
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ getMostCommonMood() | titlecase }}</h3>
          <p>Primary Mood State</p>
        </div>
      </div>
    </div>

    <!-- Emotion Distribution Chart -->
    <div class="chart-section">
      <div class="section-header">
        <h2>Emotional State Distribution</h2>
        <p>Quantitative analysis of mood patterns across the selected timeframe</p>
      </div>
      
      <div class="emotion-chart">
        <div *ngFor="let emotion of moodKeys()" class="emotion-bar-container">
          <div class="emotion-info">
            <span class="emotion-indicator" [style.background-color]="getMoodColor(emotion)"></span>
            <span class="emotion-name">{{ emotion | titlecase }}</span>
            <span class="emotion-count">{{ moodHistory.emotion_distribution[emotion] }}</span>
            <span class="emotion-percentage">
              ({{ ((moodHistory.emotion_distribution[emotion] / moodHistory.total_entries) * 100) | number:'1.1-1' }}%)
            </span>
          </div>
          <div class="emotion-bar">
            <div class="emotion-fill" 
                 [style.width.%]="(moodHistory.emotion_distribution[emotion] / getMaxCount()) * 100"
                 [style.background-color]="getMoodColor(emotion)">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Timeline Section -->
    <div class="timeline-section">
      <div class="section-header">
        <h2>Temporal Mood Analysis</h2>
        <p>Daily breakdown and trends in emotional state patterns</p>
      </div>
      
      <div class="timeline-container">
        <div class="timeline-header">
          <span class="timeline-col-date">Date</span>
          <span class="timeline-col-emotions">Emotional States</span>
          <span class="timeline-col-total">Total</span>
        </div>
        
        <div *ngFor="let day of getTimelineData()" class="timeline-day">
          <div class="timeline-date">
            <span class="date-text">{{ formatDate(day.date) }}</span>
          </div>
          <div class="timeline-moods">
            <div *ngFor="let moodEntry of day.emotions" 
                 class="mood-entry">
              <span class="mood-indicator" [style.background-color]="getMoodColor(moodEntry.emotion)"></span>
              <span class="mood-label">{{ moodEntry.emotion | titlecase }}</span>
              <span class="mood-count">{{ moodEntry.count }}</span>
            </div>
          </div>
          <!-- <div class="timeline-total">
            {{ day.emotions.reduce((sum, emotion) => sum + emotion.count, 0) }}
          </div> -->
        </div>
      </div>
    </div>

    <!-- Summary Analytics -->
    <div class="summary-section">
      <div class="section-header">
        <h2>Analytics Summary</h2>
        <p>Key insights from your emotional data</p>
      </div>
      
      <div class="summary-grid">
        <div class="summary-card">
          <h4>Data Coverage</h4>
          <p>{{ moodHistory.total_entries }} emotional states recorded over {{ selectedDays }} days</p>
        </div>
        
        <div class="summary-card">
          <h4>Dominant Pattern</h4>
          <p>{{ getMostCommonMood() | titlecase }} represents the most frequent emotional state</p>
        </div>
        
        <div class="summary-card">
          <h4>Analysis Period</h4>
          <p>{{ moodHistory.date_range.start | date:'mediumDate' }} to {{ moodHistory.date_range.end | date:'mediumDate' }}</p>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="moodHistory.total_entries === 0" class="empty-state">
      <div class="empty-icon">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,3V12.26C11.5,12.09 11,12 10.5,12C8.01,12 6,14.01 6,16.5S8.01,21 10.5,21S15,18.99 15,16.5V6H19V3H12Z" />
        </svg>
      </div>
      <h3>No Analytics Data Available</h3>
      <p>Begin using the music recommendation system to generate emotional analytics and insights.</p>
      <button class="cta-btn" (click)="goBackToRecommendations()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,3V12.26C11.5,12.09 11,12 10.5,12C8.01,12 6,14.01 6,16.5S8.01,21 10.5,21S15,18.99 15,16.5V6H19V3H12Z" />
        </svg>
        Start Analysis
      </button>
    </div>
  </div>
</div>
